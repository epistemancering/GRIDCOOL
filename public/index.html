<!doctypehtml>
<html>
<head>
<link href = "" rel = "icon">
<style>
#title, #grid {border-style: solid; border-width: .5vh; cursor: default; display: flex; margin: auto;}
#title div, div div div {border-style: solid; border-width: .5vh; width: 100%;}
#grid > div {display: flex; height: 100%;}
</style>
<title>
    GRIDCOOL
</title>
</head>

<body style = "border-collapse: collapse; font-family: monospace; line-height: 1; margin: 0; text-align: center;">
<div id = "title" style = "font-size: 16vh; margin-bottom: 1vh; width: 136vh;">
    <div>
        G
    </div>
    <div>
        R
    </div>
    <div>
        I
    </div>
    <div>
        D
    </div>
    <div>
        C
    </div>
    <div>
        O
    </div>
    <div>
        O
    </div>
    <div>
        L
    </div>
</div>
<div id = "grid" style = "flex-direction: column; font-size: 8vh; height: 80vh; width: 80vh;">
    <div>
        <div>
        </div>
        <div>
        </div>
        <div>
        </div>
        <div>
        </div>
        <div>
        </div>
        <div>
        </div>
        <div>
        </div>
        <div>
        </div>
    </div>
    <div>
        <div>
        </div>
        <div>
        </div>
        <div>
        </div>
        <div>
        </div>
        <div>
        </div>
        <div>
        </div>
        <div>
        </div>
        <div>
        </div>
    </div>
    <div>
        <div>
        </div>
        <div>
        </div>
        <div>
        </div>
        <div>
        </div>
        <div>
        </div>
        <div>
        </div>
        <div>
        </div>
        <div>
        </div>
    </div>
    <div>
        <div>
        </div>
        <div>
        </div>
        <div>
        </div>
        <div>
        </div>
        <div>
        </div>
        <div>
        </div>
        <div>
        </div>
        <div>
        </div>
    </div>
    <div>
        <div>
        </div>
        <div>
        </div>
        <div>
        </div>
        <div>
        </div>
        <div>
        </div>
        <div>
        </div>
        <div>
        </div>
        <div>
        </div>
    </div>
    <div>
        <div>
        </div>
        <div>
        </div>
        <div>
        </div>
        <div>
        </div>
        <div>
        </div>
        <div>
        </div>
        <div>
        </div>
        <div>
        </div>
    </div>
    <div>
        <div>
        </div>
        <div>
        </div>
        <div>
        </div>
        <div>
        </div>
        <div>
        </div>
        <div>
        </div>
        <div>
        </div>
        <div>
        </div>
    </div>
    <div>
        <div>
        </div>
        <div>
        </div>
        <div>
        </div>
        <div>
        </div>
        <div>
        </div>
        <div>
        </div>
        <div>
        </div>
        <div>
        </div>
    </div>
</div>

<script src = "https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js">
</script>
<script>
function message(text) {
    blank()
    text = text.slice(1).split("\n")
    for (let index1 in text) {
        for (let index2 in text[index1]) {
            grid[index1].children[index2].innerHTML = text[index1][index2]
        }
    }
}
function blank() {
    let index1 = 8
    while (index1--) {
        let index2 = 8
        while (index2--) {
            grid[index1].children[index2].innerHTML = ""
            grid[index1].children[index2].style.color = ""
            grid[index1].children[index2].style.cursor = ""
        }
    }
}
function display(positions) {
    console.log("playing in room " + room + " as player " + player)
    console.log(positions)
    blank()
    grid[positions[1].y].children[positions[1].x].style.color = "lime"
    grid[positions[2].y].children[positions[2].x].style.color = "red"
    let index = 3
    while (--index) {
        if (positions[index].direction === "north") {
            grid[positions[index].y].children[positions[index].x].innerHTML = "^"
        } else if (positions[index].direction === "east") {
            grid[positions[index].y].children[positions[index].x].innerHTML = ">"
        } else if (positions[index].direction === "south") {
            grid[positions[index].y].children[positions[index].x].innerHTML = "v"
        } else {
            grid[positions[index].y].children[positions[index].x].innerHTML = "<"
        }
    }
    if (positions[1].x === positions[2].x) {
        if (positions[1].y < positions[2].y) {
            if (positions[1].direction === "south") {
                grid[positions[2].y].children[positions[2].x].style.filter = "blur(.5vh)"
                let index = positions[1].y
                while (++index !== positions[2].y) {
                    grid[index].children[positions[1].x].innerHTML = "|"
                }
                player = undefined
            }
            if (positions[2].direction === "north") {
                grid[positions[1].y].children[positions[1].x].style.filter = "blur(.5vh)"
                let index = positions[1].y
                while (++index !== positions[2].y) {
                    grid[index].children[positions[1].x].innerHTML = "|"
                }
                player = undefined
            }
        } else {
            if (positions[1].direction === "north") {
                grid[positions[2].y].children[positions[2].x].style.filter = "blur(.5vh)"
                let index = positions[2].y
                while (++index !== positions[1].y) {
                    grid[index].children[positions[1].x].innerHTML = "|"
                }
                player = undefined
            }
            if (positions[2].direction === "south") {
                grid[positions[1].y].children[positions[1].x].style.filter = "blur(.5vh)"
                let index = positions[2].y
                while (++index !== positions[1].y) {
                    grid[index].children[positions[1].x].innerHTML = "|"
                }
                player = undefined
            }
        }
    }
    if (positions[1].y === positions[2].y) {
        if (positions[1].x < positions[2].x) {
            if (positions[1].direction === "east") {
                grid[positions[2].y].children[positions[2].x].style.filter = "blur(.5vh)"
                let index = positions[1].x
                while (++index !== positions[2].x) {
                    grid[positions[1].y].children[index].innerHTML = "-"
                }
                player = undefined
            }
            if (positions[2].direction === "west") {
                grid[positions[1].y].children[positions[1].x].style.filter = "blur(.5vh)"
                let index = positions[1].x
                while (++index !== positions[2].x) {
                    grid[positions[1].y].children[index].innerHTML = "-"
                }
                player = undefined
            }
        } else {
            if (positions[1].direction === "west") {
                grid[positions[2].y].children[positions[2].x].style.filter = "blur(.5vh)"
                let index = positions[2].x
                while (++index !== positions[1].x) {
                    grid[positions[1].y].children[index].innerHTML = "-"
                }
                player = undefined
            }
            if (positions[2].direction === "east") {
                grid[positions[1].y].children[positions[1].x].style.filter = "blur(.5vh)"
                let index = positions[2].x
                while (++index !== positions[1].x) {
                    grid[positions[1].y].children[index].innerHTML = "-"
                }
                player = undefined
            }
        }
    }
    if (player) {
        if (positions[player].y) {
            north = grid[positions[player].y - 1].children[positions[player].x]
            north.addEventListener("click", move)
            north.style.cursor = "pointer"
            if (north.style.color === "") {
                north.innerHTML = "^"
            }
        }
        if (positions[player].x !== 7) {
            east = grid[positions[player].y].children[positions[player].x + 1]
            east.addEventListener("click", move)
            east.style.cursor = "pointer"
            if (east.style.color === "") {
                east.innerHTML = ">"
            }
        }
        if (positions[player].y !== 7) {
            south = grid[positions[player].y + 1].children[positions[player].x]
            south.addEventListener("click", move)
            south.style.cursor = "pointer"
            if (south.style.color === "") {
                south.innerHTML = "v"
            }
        }
        if (positions[player].x) {
            west = grid[positions[player].y].children[positions[player].x - 1]
            west.addEventListener("click", move)
            west.style.cursor = "pointer"
            if (west.style.color === "") {
                west.innerHTML = "<"
            }
        }
    }
}
function move(event) {
    let motion
    if (event.target === north) {
        motion = "north"
    } else if (event.target === east) {
        motion = "east"
    } else if (event.target === south) {
        motion = "south"
    } else {
        motion = "west"
    }
    let index1 = 8
    while (index1--) {
        let index2 = 8
        while (index2--) {
            if (grid[index1].children[index2].style.cursor === "pointer") {
                grid[index1].children[index2].removeEventListener("click", move)
                grid[index1].children[index2].style.cursor = ""
                if (grid[index1].children[index2].style.color === "") {
                    grid[index1].children[index2].innerHTML = ""
                }
            }
        }
    }
    axios.put("/move?room=" + room + "&player=" + player + "&move=" + motion).then(function(response) {
        display(response.data)
    }).catch(function() {
        message(`

no
response
   from
opponent

refresh?
        `)
    })
}
let room
let player
let grid = document.querySelector("#grid").children
let north
let east
let south
let west
message(`


waiting
  for
opponent
     ...
`)
axios.get("/start").then(function(response) {
    console.log(response)
    room = response.data.room
    player = response.data.player
    display(response.data.positions)
}).catch(function() {
    message(`

no
opponent
   found


refresh?
    `)
})
</script>
</body>
</html>