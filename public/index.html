<!doctypehtml>
<html>
<head>
<!-- <link href = "" rel = "icon"> -->
<style>
#title, #grid {border-style: solid; border-width: .5vh; cursor: default; display: flex; margin: auto;}
#title div, div div div {border-style: solid; border-width: .5vh; width: 100%;}
#grid > div {display: flex; height: 100%;}
</style>
<title>
    GRIDCOOL
</title>
</head>

<body style = "border-collapse: collapse; font-family: monospace; line-height: 1; margin: 0; text-align: center;">
<div id = "title" style = "font-size: 16vh; margin-bottom: 1vh; width: 136vh;">
    <div>
        G
    </div>
    <div>
        R
    </div>
    <div>
        I
    </div>
    <div>
        D
    </div>
    <div>
        C
    </div>
    <div>
        O
    </div>
    <div>
        O
    </div>
    <div>
        L
    </div>
</div>
<div id = "grid" style = "flex-direction: column-reverse; font-size: 8vh; height: 80vh; width: 80vh;">
    <div>
        <div>
        </div>
        <div>
        </div>
        <div>
        </div>
        <div>
        </div>
        <div>
        </div>
        <div>
        </div>
        <div>
        </div>
        <div>
        </div>
    </div>
    <div>
        <div>
        </div>
        <div>
        </div>
        <div>
        </div>
        <div>
        </div>
        <div>
        </div>
        <div>
        </div>
        <div>
        </div>
        <div>
        </div>
    </div>
    <div>
        <div>
        </div>
        <div>
        </div>
        <div>
        </div>
        <div>
        </div>
        <div>
        </div>
        <div>
        </div>
        <div>
        </div>
        <div>
        </div>
    </div>
    <div>
        <div>
        </div>
        <div>
        </div>
        <div>
        </div>
        <div>
        </div>
        <div>
        </div>
        <div>
        </div>
        <div>
        </div>
        <div>
        </div>
    </div>
    <div>
        <div>
        </div>
        <div>
        </div>
        <div>
        </div>
        <div>
        </div>
        <div>
        </div>
        <div>
        </div>
        <div>
        </div>
        <div>
        </div>
    </div>
    <div>
        <div>
        </div>
        <div>
        </div>
        <div>
        </div>
        <div>
        </div>
        <div>
        </div>
        <div>
        </div>
        <div>
        </div>
        <div>
        </div>
    </div>
    <div>
        <div>
        </div>
        <div>
        </div>
        <div>
        </div>
        <div>
        </div>
        <div>
        </div>
        <div>
        </div>
        <div>
        </div>
        <div>
        </div>
    </div>
    <div>
        <div>
        </div>
        <div>
        </div>
        <div>
        </div>
        <div>
        </div>
        <div>
        </div>
        <div>
        </div>
        <div>
        </div>
        <div>
        </div>
    </div>
</div>

<script src = "axios.min.js">
</script>
<script>
function message(text) {
    blank()
    text = text.slice(1).split("\n")
    for (let index1 in text) {
        for (let index2 in text[index1]) {
            grid[7 - index1].children[index2].innerHTML = text[index1][index2]
        }
    }
}
function blank() {
    let index1 = 8
    while (index1--) {
        let index2 = 8
        while (index2--) {
            grid[index1].children[index2].innerHTML = ""
            grid[index1].children[index2].style.color = ""
            grid[index1].children[index2].style.cursor = ""
        }
    }
}
function start(response) {
    if (response.data) {
        room = response.data.room
        if (response.data.positions) {
            player = response.data.player
            positions = response.data.positions
            display()
        } else {
            axios.get("/start?room=" + room).then(start)
        }
    } else {
        axios.get("/start").then(start)
    }
}
function display() {
    console.log(positions)
    blank()
    grid[positions[0].y].children[positions[0].x].style.color = "lime"
    grid[positions[1].y].children[positions[1].x].style.color = "red"
    for (let index in positions) {
        grid[positions[index].y].children[positions[index].x].innerHTML = symbols[positions[index].axis][positions[index].direction]
        if (positions[index].fire) {
            let target = Number(!Number(index))
            let trail = { "x": positions[index].x, "y": positions[index].y }
            while ((trail[positions[index].axis] += positions[index].direction) !== positions[target][positions[index].axis]) {
                grid[trail.y].children[trail.x].innerHTML = trails[positions[index].axis]
            }
            grid[trail.y].children[trail.x].style.filter = "blur(.5vh)"
            room = undefined
        }
    }
    if (room !== undefined) {
        arrows = { "x": [], "y": [] }
        for (let index1 in symbols) {
            for (let index2 in symbols[index1]) {
                let coordinates = { "x": positions[player].x, "y": positions[player].y }
                if (grid[coordinates[index1] += Number(index2)]) {
                    arrows[index1][index2] = grid[coordinates.y].children[coordinates.x]
                    arrows[index1][index2].addEventListener("click", move)
                    arrows[index1][index2].style.cursor = "pointer"
                    if (!arrows[index1][index2].innerHTML) {
                        arrows[index1][index2].innerHTML = symbols[index1][index2]
                    }
                }
            }
        }
        grid[positions[player].y].children[positions[player].x].addEventListener("click", move)
        grid[positions[player].y].children[positions[player].x].style.cursor = "pointer"
    }
}
function move(event) {
    let axis = positions[player].axis
    let direction = 0
    for (let index1 in arrows) {
        for (let index2 in arrows[index1]) {
            if (arrows[index1][index2] === event.target) {
                axis = index1
                direction = index2
            }
            arrows[index1][index2].removeEventListener("click", move)
            arrows[index1][index2].style.cursor = ""
            if (!arrows[index1][index2].style.color) {
                arrows[index1][index2].innerHTML = ""
            }
        }
    }
    grid[positions[player].y].children[positions[player].x].removeEventListener("click", move)
    grid[positions[player].y].children[positions[player].x].style.cursor = ""
    axios.put("/move?room=" + room + "&player=" + player + "&axis=" + axis + "&direction=" + direction).then(function(response) {
        positions = response.data
        display()
    })
}
let room
let player
let positions
let grid = document.querySelector("#grid").children
let arrows
let symbols = { "x": [, ">"], "y": [, "^"] }
symbols.x[-1] = "<"
symbols.y[-1] = "v"
let trails = { "x": "-", "y": "|"}
message(`


waiting
  for
opponent
     ...
`)
start({})
</script>
</body>
</html>